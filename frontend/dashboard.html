<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Cycling Performance Analytics Dashboard">
  <title>Dashboard - Cycling Analytics</title>
  
  <!-- Preconnect to improve performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  
  <!-- Inter Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
  
  <!-- SINGLE CSS IMPORT - main.css imports everything else in correct order -->
  <link rel="stylesheet" href="/static/css/main.css">
  
  <!-- Feather Icons -->
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
  
  <style>
    /* CRITICAL: Ensure Feather icons are always visible */
    .sidebar i[data-feather],
    .nav-item i[data-feather],
    .sidebar-brand i[data-feather],
    .user-avatar i[data-feather],
    .logout-btn i[data-feather] {
      display: inline-flex !important;
      width: 20px;
      height: 20px;
      stroke: currentColor;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
      fill: none;
    }
    
    /* Make SVG icons visible */
    .sidebar svg,
    .nav-item svg {
      display: block !important;
      pointer-events: none;
    }
    
    /* Ensure logout button is clickable */
    .logout-btn {
      cursor: pointer;
      pointer-events: all !important;
    }
  </style>
</head>
<body>
  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loading-overlay" style="display: none;">
    <div class="loading-spinner"></div>
  </div>

  <!-- Notification Container -->
  <div class="notification" id="notification"></div>

  <!-- App Container -->
  <div class="app-container">
    
    <!-- ========== COLLAPSIBLE SIDEBAR ========== -->
    <aside class="sidebar" id="sidebar">
      <!-- Sidebar Header -->
      <div class="sidebar-header">
        <div class="sidebar-brand">
          <i data-feather="zap"></i>
          <span>CyclingMetrics</span>
        </div>
      </div>

      <!-- Sidebar Navigation -->
      <nav class="sidebar-nav">
        <!-- Dashboard Section -->
        <div class="nav-section">
          <div class="nav-section-title">Dashboard</div>
          <a href="#overview" class="nav-item active" data-page="overview" data-tooltip="Overview">
            <i data-feather="home"></i>
            <span>Overview</span>
          </a>
        </div>

        <!-- Performance Section -->
        <div class="nav-section">
          <div class="nav-section-title">Performance</div>
          <a href="#training-load" class="nav-item" data-page="training-load" data-tooltip="Training Load">
            <i data-feather="trending-up"></i>
            <span>Training Load</span>
          </a>
          <a href="#power-curve" class="nav-item" data-page="power-curve" data-tooltip="Power Curve">
            <i data-feather="activity"></i>
            <span>Power Curve</span>
          </a>
          <a href="#critical-power" class="nav-item" data-page="critical-power" data-tooltip="Critical Power">
            <i data-feather="target"></i>
            <span>Critical Power</span>
          </a>
          <a href="#efficiency" class="nav-item" data-page="efficiency" data-tooltip="Efficiency">
            <i data-feather="percent"></i>
            <span>Efficiency</span>
          </a>
          <a href="#best-powers" class="nav-item" data-page="best-powers" data-tooltip="Best Powers">
            <i data-feather="award"></i>
            <span>Best Powers</span>
          </a>
        </div>

        <!-- Analysis Section -->
        <div class="nav-section">
          <div class="nav-section-title">Analysis</div>
          <a href="#zones" class="nav-item" data-page="zones" data-tooltip="Power Zones">
            <i data-feather="layers"></i>
            <span>Power Zones</span>
          </a>
          <a href="#hr-zones" class="nav-item" data-page="hr-zones" data-tooltip="HR Zones">
            <i data-feather="heart"></i>
            <span>HR Zones</span>
          </a>
          <a href="#vo2max" class="nav-item" data-page="vo2max" data-tooltip="VO2 Max">
            <i data-feather="wind"></i>
            <span>VO2 Max</span>
          </a>
          <a href="#fitness-state" class="nav-item" data-page="fitness-state" data-tooltip="Fitness State">
            <i data-feather="thermometer"></i>
            <span>Fitness State</span>
          </a>
        </div>

        <!-- Data Section -->
        <div class="nav-section">
          <div class="nav-section-title">Data</div>
          <a href="#activities" class="nav-item" data-page="activities" data-tooltip="Activities">
            <i data-feather="list"></i>
            <span>Activities</span>
          </a>
          <a href="#upload" class="nav-item" data-page="upload" data-tooltip="Upload">
            <i data-feather="upload"></i>
            <span>Upload</span>
          </a>
          <a href="#settings" class="nav-item" data-page="settings" data-tooltip="Settings">
            <i data-feather="settings"></i>
            <span>Settings</span>
          </a>
        </div>
      </nav>

      <!-- Sidebar Footer -->
      <div class="sidebar-footer">
        <div class="user-info">
          <div class="user-avatar" id="user-avatar">
            <i data-feather="user"></i>
          </div>
          <span id="userEmail">User</span>
        </div>
        <button class="logout-btn" id="logout-btn" title="Logout" aria-label="Logout">
          <i data-feather="log-out"></i>
        </button>
      </div>
    </aside>

    <!-- ========== MAIN CONTENT ========== -->
    <main class="main-content" id="main-content">
      <!-- Main Header -->
      <header class="main-header">
        <div>
          <h1 id="page-title">Overview</h1>
          <p id="page-subtitle" style="font-size: 15px; color: #64748b; margin-top: 4px; font-weight: 500;"></p>
        </div>
        <div class="header-actions">
          <button class="btn btn--secondary btn--sm" id="refresh-btn" title="Refresh Page">
            <i data-feather="refresh-cw" style="width: 16px; height: 16px;"></i>
            <span>Refresh</span>
          </button>
          <button class="btn btn--primary btn--sm" id="upload-btn-header" title="Upload Activities">
            <i data-feather="upload" style="width: 16px; height: 16px;"></i>
            <span>Upload</span>
          </button>
        </div>
      </header>

      <!-- Content Wrapper - Pages are loaded here dynamically -->
      <div id="pageContent">
        <!-- Dynamic page content will be injected here by JavaScript -->
        <div style="padding: 60px 20px; text-align: center; color: #94a3b8;">
          <div class="loading-spinner" style="margin: 0 auto 20px;"></div>
          <p style="font-size: 15px; font-weight: 500;">Loading dashboard...</p>
        </div>
      </div>
    </main>
  </div>

  <!-- ========== JAVASCRIPT MODULES ========== -->
  <!-- Core utilities - Load first -->
  <script type="module" src="/static/js/core/config.js"></script>
  <script type="module" src="/static/js/core/eventBus.js"></script>
  <script type="module" src="/static/js/core/state.js"></script>
  <script type="module" src="/static/js/core/utils.js"></script>
  <script type="module" src="/static/js/core/api.js"></script>
  
  <!-- Router -->
  <script type="module" src="/static/js/core/router.js"></script>
  
  <!-- Main dashboard controller - Load last -->
  <script type="module" src="/static/js/core/dashboard.js"></script>

  <!-- Initialize Feather Icons - CRITICAL FOR ICON VISIBILITY -->
  <script>
    // Initialize immediately
    function initFeatherIcons() {
      if (typeof feather !== 'undefined') {
        feather.replace();
        console.log('[Dashboard] Feather icons initialized');
      } else {
        console.error('[Dashboard] Feather icons library not loaded!');
      }
    }
    
    // Initialize on DOM ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initFeatherIcons);
    } else {
      initFeatherIcons();
    }
    
    // Re-initialize after slight delay to catch dynamic content
    setTimeout(() => {
      if (typeof feather !== 'undefined') {
        feather.replace();
        console.log('[Dashboard] Feather icons re-initialized');
      }
    }, 200);
    
    // Watch for DOM changes and re-initialize icons
    if (typeof MutationObserver !== 'undefined') {
      const observer = new MutationObserver(() => {
        if (typeof feather !== 'undefined') {
          feather.replace();
        }
      });
      
      // Start observing after DOM is ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
          observer.observe(document.body, {
            childList: true,
            subtree: true
          });
        });
      } else {
        observer.observe(document.body, {
          childList: true,
          subtree: true
        });
      }
    }
    
    // Mobile sidebar functionality
    document.addEventListener('DOMContentLoaded', () => {
      const sidebar = document.getElementById('sidebar');
      
      if (sidebar) {
        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', (e) => {
          if (window.innerWidth <= 1024) {
            if (!sidebar.contains(e.target)) {
              sidebar.classList.remove('mobile-open');
            }
          }
        });
        
        // Prevent clicks inside sidebar from closing it
        sidebar.addEventListener('click', (e) => {
          e.stopPropagation();
        });
      }
      
      // Additional check for logout button
      const logoutBtn = document.getElementById('logout-btn');
      if (logoutBtn) {
        console.log('[Dashboard HTML] Logout button found in DOM');
      } else {
        console.error('[Dashboard HTML] Logout button NOT found in DOM!');
      }
      
      console.log('[Dashboard HTML] Page initialized successfully');
    });
  </script>
</body>
</html>